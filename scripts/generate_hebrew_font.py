#!/usr/bin/env python3
"""
Generate Hebrew font characters from the fontData_ExtendedHebrew array.
Creates PNG files for characters 128-154 (27 Hebrew letters).
"""

import struct
from pathlib import Path
from PIL import Image


# Hebrew font data from DosFont::fontData_ExtendedHebrew[27 * 8]
# Each character is 8x8 pixels, with 8 bytes per character
fontData_ExtendedHebrew = [
    0x43, 0x63, 0x36, 0x3E, 0x6E, 0x47, 0x43, 0x00,
    0x3C, 0x7E, 0x06, 0x06, 0x06, 0x3F, 0x7F, 0x00,
    0x3E, 0x7F, 0x03, 0x3F, 0x7F, 0x63, 0x63, 0x00,
    0x3E, 0x7F, 0x06, 0x06, 0x06, 0x06, 0x06, 0x00,
    0x3E, 0x7F, 0x03, 0x23, 0x63, 0x63, 0x63, 0x00,
    0x18, 0x3C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x00,
    0x3C, 0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00,
    0x3E, 0x7F, 0x63, 0x63, 0x63, 0x63, 0x63, 0x00,
    0x26, 0x6F, 0x6B, 0x63, 0x63, 0x7F, 0x3E, 0x00,
    0x1C, 0x3C, 0x0C, 0x0C, 0x00, 0x00, 0x00, 0x00,
    0x3F, 0x7F, 0x07, 0x03, 0x03, 0x03, 0x03, 0x03,
    0x3F, 0x7F, 0x03, 0x03, 0x03, 0x3F, 0x7F, 0x00,
    0x60, 0x7E, 0x3F, 0x01, 0x07, 0x1E, 0x38, 0x00,
    0x3F, 0x7F, 0x63, 0x63, 0x63, 0x7F, 0x7F, 0x00,
    0x4C, 0x7E, 0x73, 0x23, 0x63, 0x67, 0x6F, 0x00,
    0x0C, 0x1E, 0x06, 0x06, 0x06, 0x06, 0x06, 0x06,
    0x07, 0x0F, 0x03, 0x03, 0x03, 0x1F, 0x3F, 0x00,
    0x3E, 0x7F, 0x63, 0x63, 0x63, 0x7F, 0x3E, 0x00,
    0x63, 0x63, 0x73, 0x33, 0x1B, 0x7F, 0x7E, 0x00,
    0x1C, 0x3E, 0x26, 0x36, 0x36, 0x06, 0x06, 0x06,
    0x3E, 0x7F, 0x61, 0x79, 0x01, 0x3F, 0x7F, 0x00,
    0x66, 0x66, 0x36, 0x3C, 0x18, 0x18, 0x18, 0x18,
    0x63, 0x73, 0x3E, 0x1C, 0x0E, 0x3F, 0x7F, 0x00,
    0x7F, 0x7F, 0x03, 0x6E, 0x6C, 0x68, 0x60, 0x60,
    0x3E, 0x7F, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00,
    0x2A, 0x6B, 0x6B, 0x6B, 0x6B, 0x7F, 0x3E, 0x00,
    0x1E, 0x3F, 0x33, 0x33, 0x33, 0x73, 0x73, 0x00
]


def create_image(width, height, bitmap_data):
    """Create a PIL Image from bitmap data."""
    # Create a new black and white image
    img = Image.new('1', (width, height), 0)
    
    # Each byte in bitmap_data represents one row (for 8x8 characters)
    for y in range(height):
        byte_val = bitmap_data[y]
        for x in range(width):
            bit_index = 7 - x  # MSB first
            pixel = (byte_val >> bit_index) & 1
            img.putpixel((x, y), pixel)
    
    return img


def generate_hebrew_fonts(output_dir):
    """Generate Hebrew font BMPs from fontData_ExtendedHebrew."""
    
    # Create output directory
    output_path = Path(output_dir)
    output_path.mkdir(parents=True, exist_ok=True)
    
    # Each character is 8x8 pixels with 8 bytes
    width = 8
    height = 8
    bytes_per_char = 8
    num_chars = len(fontData_ExtendedHebrew) // bytes_per_char
    
    print(f"Generating {num_chars} Hebrew characters (128-154)...")
    print(f"Size: {width}x{height} pixels")
    print()
    
    # Generate each character
    for char_index in range(num_chars):
        # Extract the 8 bytes for this character
        start = char_index * bytes_per_char
        end = start + bytes_per_char
        char_data = fontData_ExtendedHebrew[start:end]
        
        # Character number starts at 128
        char_num = 128 + char_index
        
        # Create bitmap data
        bitmap_data = bytearray(char_data)
        
        # Create image
        img = create_image(width, height, bitmap_data)
        
        # Save to file
        output_file = output_path / f"{char_num}.png"
        img.save(output_file)
        
        print(f"Character {char_num}: {width}x{height} pixels -> {output_file.name}")
    
    print(f"\nSuccessfully generated {num_chars} Hebrew characters in {output_dir}")


if __name__ == '__main__':
    output_directory = "fonts/001"
    generate_hebrew_fonts(output_directory)
